<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Game Awards Voting</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{--bg:#121212;--card:#1E1E1E;--surface:#1A1A1A;--border:#2A2A2A;--text:#E0E0E0;--text-muted:#9CA3AF;--primary:#4FC3F7;--primary-light:#81D4FA;--primary-dark:#29B6F6;--danger:#D32F2F;}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;}
header{background:linear-gradient(90deg,var(--primary-dark),var(--primary));color:#fff;padding:14px 18px;display:flex;justify-content:space-between;}
header h1{margin:0;font-size:18px;}
.tabs button{background:transparent;border:0;color:rgba(255,255,255,0.85);padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:600;}
.tabs button.active{background:rgba(255,255,255,0.18);}
main{max-width:940px;margin:20px auto;padding:0 16px;}
.card{background:var(--card);padding:18px;border-radius:10px;margin-bottom:16px;border:1px solid var(--border);}
select,input[type=text]{width:100%;padding:8px;margin-top:4px;border-radius:6px;background:var(--surface);color:var(--text);border:1px solid var(--border);}
button{padding:8px 12px;border-radius:6px;border:0;background:var(--primary);color:#000;cursor:pointer;}
button:hover{background:var(--primary-light);}
.spaced{margin-top:12px;}
</style>
</head>
<body>

<header>
<h1>Game Awards Voting</h1>
<div class="tabs">
<button class="tab active" data-tab="vote">Vote</button>
<button class="tab" data-tab="results">Results</button>
<button class="tab" data-tab="categories">Categories</button>
<button class="tab" data-tab="admin">Admin</button>
</div>
</header>

<main id="app"></main>

<footer style="text-align:center;color:var(--text-muted);padding:12px;">Firebase Powered</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7938E45kuERRFVTKV5djhBGoqeDN29XY",
  authDomain: "game-awards-voting-d2539.firebaseapp.com",
  databaseURL: "https://game-awards-voting-d2539-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "game-awards-voting-d2539",
  storageBucket: "game-awards-voting-d2539.appspot.com",
  messagingSenderId: "138398205198",
  appId: "1:138398205198:web:8ca44d0fee61f97ab7035f",
  measurementId: "G-DMH48E4BZN"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const appEl = document.getElementById('app');
const tabs = document.querySelectorAll('.tab');
const ADMIN_PASS = 'admin123';

tabs.forEach(t=>t.addEventListener('click', ()=>{ tabs.forEach(b=>b.classList.remove('active')); t.classList.add('active'); showPage(t.dataset.tab); }));

function showPage(page){
  appEl.innerHTML='';
  if(page==='vote') renderVotePage();
  else if(page==='results') renderResultsPage();
  else if(page==='categories') renderCategoriesPage();
  else if(page==='admin') renderAdminPage();
}

// Helper: escape
function e(s){ return s ? s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : ''; }

// ------------------ Pages ------------------
function renderVotePage(){
  const card = document.createElement('div'); card.className='card';
  card.innerHTML='<h2>Vote</h2><input type="text" id="voter-name" placeholder="Your name"><div id="vote-area" class="spaced"></div><button id="submit-vote" class="spaced">Submit</button>';
  appEl.appendChild(card);

  db.ref('categories').once('value').then(snap=>{
    const cats = snap.val()||[];
    const area = card.querySelector('#vote-area');
    cats.forEach(c=>{
      const div = document.createElement('div'); div.className='spaced';
      div.innerHTML = `<strong>${e(c.name)}</strong><br>
        <label>Who will win?</label><select class="willWin"></select>
        <label>Who do you want to win?</label><select class="wantWin"></select>`;
      area.appendChild(div);
      const selWill = div.querySelector('.willWin'); const selWant = div.querySelector('.wantWin');
      selWill.innerHTML='<option value="">—Select—</option>'; selWant.innerHTML='<option value="">—Select—</option>';
      (c.nominees||[]).forEach(n=>{ selWill.innerHTML+=`<option>${e(n)}</option>`; selWant.innerHTML+=`<option>${e(n)}</option>`; });
    });

    card.querySelector('#submit-vote').addEventListener('click', ()=>{
      const name = card.querySelector('#voter-name').value.trim(); if(!name) return alert('Enter name');
      const vote={};
      area.querySelectorAll('div').forEach(d=>{
        const catName=d.querySelector('strong').innerText;
        vote[catName]={ willWin:d.querySelector('.willWin').value, wantWin:d.querySelector('.wantWin').value };
      });
      db.ref('votes/'+name).set(vote);
      alert('Votes saved!');
    });
  });
}

function renderResultsPage(){
  const card = document.createElement('div'); card.className='card'; card.innerHTML='<h2>Results</h2>';
  appEl.appendChild(card);
  db.ref('votes').once('value').then(snap=>{
    const votes = snap.val()||{};
    if(Object.keys(votes).length===0){ card.innerHTML+='<p>No votes yet.</p>'; return; }
    for(const [user,v] of Object.entries(votes)){
      const div = document.createElement('div'); div.className='spaced';
      div.innerHTML=`<strong>${e(user)}</strong><br>${Object.entries(v).map(([c,vv])=>`${e(c)}: Will=${e(vv.willWin)}, Want=${e(vv.wantWin)}`).join('<br>')}`;
      card.appendChild(div);
    }
  });
}

function renderCategoriesPage(){
  const card = document.createElement('div'); card.className='card'; card.innerHTML='<h2>Categories</h2>'; appEl.appendChild(card);
  db.ref('categories').once('value').then(snap=>{
    const cats = snap.val()||[];
    cats.forEach((c,idx)=>{
      const div=document.createElement('div'); div.className='spaced';
      div.innerHTML=`<strong>${e(c.name)}</strong>: ${(c.nominees||[]).map(n=>e(n)).join(', ')}`;
      card.appendChild(div);
    });
  });
}

function renderAdminPage(){
  const card = document.createElement('div'); card.className='card'; appEl.appendChild(card);
  if(localStorage.getItem('admin')!=='1'){
    card.innerHTML='<h2>Admin Login</h2><input type="password" id="admin-pass" placeholder="Password"><button id="login-btn" class="spaced">Login</button>';
    card.querySelector('#login-btn').addEventListener('click', ()=>{
      if(card.querySelector('#admin-pass').value===ADMIN_PASS){ localStorage.setItem('admin','1'); renderAdminPage(); }
      else alert('Wrong password');
    });
    return;
  }
  card.innerHTML='<h2>Admin Panel</h2><button id="logout-btn" class="spaced">Logout</button>';
  card.querySelector('#logout-btn').addEventListener('click', ()=>{ localStorage.removeItem('admin'); renderAdminPage(); });
  // Here you can add category management using Firebase
}

showPage('vote');
</script>
</body>
</html>
